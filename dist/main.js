(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{mm:()=>G,Tt:()=>$,HK:()=>Z,C3:()=>J,iZ:()=>F});var e={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-13",headers:{authorization:"529f3fca-6bdc-4e81-9927-7f5521acabce","Content-Type":"application/json"}};function n(t){t.classList.remove("pop-up_opened"),document.removeEventListener("keydown",o)}function r(t){t.classList.add("pop-up_opened"),document.addEventListener("keydown",o)}function o(t){"Escape"===t.key&&n(document.querySelector(".pop-up_opened"))}var a=document.querySelector(".main"),i=a.querySelector(".template-photo-card").content.querySelector(".photo-card"),c=a.querySelector(".form-image__image"),u=a.querySelector(".form-image__title"),l=a.querySelector("#pop-up-image"),s=a.querySelector("#pop-up-request-delete"),d=a.querySelector("#buttonDeleteCard");function f(t,n,o,a,f){var h=i.cloneNode(!0),v=h.querySelector(".photo-card__photo"),m=h.querySelector(".photo-card__title"),p=h.querySelector(".button-like"),y=h.querySelector(".button-delete"),b=h.querySelector(".photo-card__like-counter");return f&&J.find((function(t){return t._id===a})).owner._id!==F?y.classList.add("button-delete_disable"):y.addEventListener("click",(function(){return function(t){d.setAttribute("name",t),r(s)}(a)})),o.some((function(t){return t._id===F}))&&p.classList.add("button-like_active"),h.setAttribute("id",a),b.textContent=o.length,m.textContent=t,v.setAttribute("src",n),v.alt=t,p.addEventListener("click",(function(t){return function(t,n){var r;t.target.classList.contains("button-like_active")?(r=t.target.closest(".photo-card").id,fetch("".concat(e.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:{authorization:e.headers.authorization}})).then(G).then((function(e){n.textContent=e.likes.length,t.target.classList.remove("button-like_active")})).catch((function(t){return console.log(t)})):function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:e.headers.authorization}})}(t.target.closest(".photo-card").id).then(G).then((function(e){n.textContent=e.likes.length,t.target.classList.add("button-like_active")})).catch((function(t){return console.log(t)}))}(t,b)})),v.addEventListener("click",(function(){return function(t,e){c.setAttribute("src",e),c.alt=t,u.textContent=t,r(l)}(t,n)})),h}function h(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n),e.removeAttribute("disabled")):(e.classList.add(n),e.setAttribute("disabled","disabled"))}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}d.addEventListener("click",(function(t){var r;Z(d),(r=t.target.name,fetch("".concat(e.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:{authorization:e.headers.authorization}})).then(G).then((function(){document.getElementById("".concat(t.target.name)).remove(),t.target.name="",n(s)})).catch((function(t){return console.log(t)})).finally((function(){$(d)}))}));var m,p,y,b,S,_,q=document.querySelector(".main"),g=q.querySelector(".button-edit"),A=q.querySelector("#buttonAddCard"),E=q.querySelectorAll(".pop-up"),L=q.querySelector(".profile__avatar-edit"),k=q.querySelector(".photo-panel"),C=q.querySelector("#pop-up-edit"),x=q.querySelector("#pop-up-add"),j=q.querySelector("#pop-up-add-avatar"),z=C.querySelector("#edit-form"),U=q.querySelector("#add-form"),P=q.querySelector("#add-avatar"),w=C.querySelector("#edit-name"),O=C.querySelector("#edit-subname"),T=q.querySelector(".profile__title-name"),D=q.querySelector(".profile__subtitle-description"),I=q.querySelector("#add-name"),N=q.querySelector("#add-image"),B=q.querySelector("#input-add-avatar"),H=q.querySelector(".profile__avatar"),J=[],F="";function M(t,e){T.textContent=t,D.textContent=e}function K(t){H.setAttribute("src",t)}function Z(t){t.textContent+="..."}function $(t){t.textContent=t.textContent.slice(0,-3)}function G(t){return t.ok?t.json():Promise.reject(t.status)}Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:{authorization:e.headers.authorization}}),fetch("".concat(e.baseUrl,"/cards"),{headers:{authorization:e.headers.authorization}})]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(a.push(r.value),!e||a.length!==e);i=!0);}catch(t){c=!0,o=t}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}}(e,n)||function(t,e){if(t){if("string"==typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],a=r[1];return o.ok&&a.ok?Promise.all([o.json(),a.json()]):Promise.reject([o.status,a.status])})).then((function(t){M(t[0].name,t[0].about),K(t[0].avatar),F=t[0]._id,t[1].forEach((function(t){var e;J.push(t),e=f(t.name,t.link,t.likes,t._id,!0),k.append(e)}))})).catch((function(t){return console.log(t)})),E.forEach((function(t){t.addEventListener("mousedown",(function(e){e.target.classList.contains("pop-up_opened")&&n(t),e.target.classList.contains("button-exit")&&n(t)}))})),z.addEventListener("submit",(function(t){t.preventDefault(),Z(z.buttonEdit),function(t,n){return fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:t,about:n})})}(w.value,O.value).then(G).then((function(t){M(t.name,t.about),n(C)})).catch((function(t){return console.log(t)})).finally((function(){$(z.buttonEdit)}))})),U.addEventListener("submit",(function(t){var r,o;t.preventDefault(),Z(U.buttonAddCard),(r=I.value,o=N.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:r,link:o})})).then(G).then((function(e){J.push(e),function(t,e,n,r,o){var a=f(t,e,n,r,!1);k.prepend(a)}(e.name,e.link,e.likes,e._id),n(x),t.target.reset()})).catch((function(t){return console.log(t)})).finally((function(){$(U.buttonAddCard)}))})),L.addEventListener("click",(function(){h(Array.from(P),P.buttonAddAvatar,"button-save_inactive"),r(j)})),P.addEventListener("submit",(function(t){var r;t.preventDefault(),Z(P.buttonAddAvatar),(r=B.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:r})})).then(G).then((function(e){K(e.avatar),n(j),t.target.reset()})).catch((function(t){return console.log(t)})).finally((function(){$(P.buttonAddAvatar)}))})),g.addEventListener("click",(function(){w.value=T.textContent,O.value=D.textContent,h(Array.from(z),z.buttonEdit,"button-save_inactive"),r(C)})),A.addEventListener("click",(function(){h(Array.from(U),U.buttonAddCard,"button-save_inactive"),r(x)})),m=(_={formSelector:".edit-from__input-container",inputSelector:".edit-form__edit",buttonSelector:".button-save",editFormErrorClass:"edit-form__edit_error",inactiveButtonClass:"button-save_inactive"}).formSelector,p=_.inputSelector,y=_.buttonSelector,b=_.editFormErrorClass,S=_.inactiveButtonClass,Array.from(document.querySelectorAll(m)).forEach((function(t){var e=t.querySelector(y),n=Array.from(t.querySelectorAll(p));h(n,e,S),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.valid?function(t,e,n){var r=t.querySelector("#".concat(e.id,"-error"));e.classList.remove(n),r.textContent=""}(t,e,n):function(t,e,n,r){var o=t.querySelector("#".concat(e.id,"-error"));e.classList.add(n),o.textContent=r}(t,e,n,e.validationMessage)}(t,r,b),h(n,e,S)}))}))}))})();