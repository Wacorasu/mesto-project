(()=>{"use strict";var t={d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};function e(t){t.classList.remove("pop-up_opened"),document.removeEventListener("keydown",n)}function o(t){t.classList.add("pop-up_opened"),document.addEventListener("keydown",n)}function n(t){"Escape"===t.key&&e(document.querySelector(".pop-up_opened"))}function r(t){t.target===t.currentTarget&&e(document.querySelector(".pop-up_opened"))}t.d({},{Tt:()=>Z,HK:()=>U,C3:()=>F,iZ:()=>I});var c=document.querySelector(".main"),a=c.querySelector(".template-photo-card").content.querySelector(".photo-card"),i=c.querySelector(".form-image__image"),u=c.querySelector(".form-image__title"),s=c.querySelector("#pop-up-image"),d=c.querySelector("#pop-up-request-delete"),l=c.querySelector("#buttonDeleteCard");function f(t,e,n,r,c){var f=a.cloneNode(!0),p=f.querySelector(".photo-card__photo"),m=f.querySelector(".photo-card__title"),h=f.querySelector(".button-like"),v=f.querySelector(".button-delete"),b=f.querySelector(".photo-card__like-counter");return c&&F.find((function(t){return t._id===r})).owner._id!==I?v.classList.add("button-delete_disable"):v.addEventListener("click",(function(){return function(t){l.setAttribute("name",t),o(d)}(r)})),n.some((function(t){return t._id===I}))&&h.classList.add("button-like_active"),f.setAttribute("id",r),b.textContent=n.length,m.textContent=t,p.setAttribute("src",e),p.alt=t,h.addEventListener("click",(function(t){return function(t,e){var o;t.target.classList.contains("button-like_active")?(o=t.target.closest(".photo-card").id,fetch("https://mesto.nomoreparties.co/v1/plus-cohort-13/cards/likes/".concat(o),{method:"DELETE",headers:{authorization:"529f3fca-6bdc-4e81-9927-7f5521acabce"}})).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(o){e.textContent=o.likes.length,t.target.classList.remove("button-like_active")})).catch((function(t){return console.log(t)})):function(t){return fetch("https://mesto.nomoreparties.co/v1/plus-cohort-13/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"529f3fca-6bdc-4e81-9927-7f5521acabce"}})}(t.target.closest(".photo-card").id).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(o){e.textContent=o.likes.length,t.target.classList.add("button-like_active")})).catch((function(t){return console.log(t)}))}(t,b)})),p.addEventListener("click",(function(){return function(t,e){i.setAttribute("src",e),i.alt=t,u.textContent=t,o(s)}(t,e)})),f}function p(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(o),e.removeAttribute("disabled")):(e.classList.add(o),e.setAttribute("disabled","disabled"))}l.addEventListener("click",(function(t){var o;U(l),(o=t.target.name,fetch("https://mesto.nomoreparties.co/v1/plus-cohort-13/cards/".concat(o),{method:"DELETE",headers:{authorization:"529f3fca-6bdc-4e81-9927-7f5521acabce"}})).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(e){document.getElementById("".concat(t.target.name)).remove(),t.target.name=""})).catch((function(t){return console.log(t)})).finally((function(){Z(l),e(d)}))}));var m,h,v,b,y,S,_=document.querySelector(".main"),q=_.querySelector(".button-edit"),g=_.querySelector("#buttonAddCard"),k=_.querySelectorAll(".button-exit, .pop-up"),E=_.querySelector(".profile__avatar-edit"),C=_.querySelector(".photo-panel"),A=_.querySelector("#pop-up-edit"),L=_.querySelector("#pop-up-add"),j=_.querySelector("#pop-up-add-avatar"),x=A.querySelector("#edit-form"),P=_.querySelector("#add-form"),T=_.querySelector("#add-avatar"),z=A.querySelector("#edit-name"),O=A.querySelector("#edit-subname"),D=_.querySelector(".profile__title-name"),w=_.querySelector(".profile__subtitle-description"),N=_.querySelector("#add-name"),B=_.querySelector("#add-image"),H=_.querySelector("#input-add-avatar"),J=_.querySelector(".profile__avatar"),F=[],I="";function K(t,e){D.textContent=t,w.textContent=e}function M(t){J.setAttribute("src",t)}function U(t){t.textContent+="..."}function Z(t){t.textContent=t.textContent.slice(0,-3)}fetch("https://mesto.nomoreparties.co/v1/plus-cohort-13/users/me",{headers:{authorization:"529f3fca-6bdc-4e81-9927-7f5521acabce"}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){K(t.name,t.about),M(t.avatar),I=t._id})).catch((function(t){return console.log(t)})),fetch("https://mesto.nomoreparties.co/v1/plus-cohort-13/cards",{headers:{authorization:"529f3fca-6bdc-4e81-9927-7f5521acabce"}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){t.forEach((function(t){var e;F.push(t),e=f(t.name,t.link,t.likes,t._id,!0),C.append(e)}))})).catch((function(t){return console.log(t)})),k.forEach((function(t){t.addEventListener("click",r)})),x.addEventListener("submit",(function(t){t.preventDefault(),U(x.buttonEdit),function(t,e){return fetch("https://mesto.nomoreparties.co/v1/plus-cohort-13/users/me",{method:"PATCH",headers:{authorization:"529f3fca-6bdc-4e81-9927-7f5521acabce","Content-Type":"application/json"},body:JSON.stringify({name:t,about:e})})}(z.value,O.value).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){K(t.name,t.about)})).catch((function(t){return console.log(t)})).finally((function(){Z(x.buttonEdit),e(A)}))})),P.addEventListener("submit",(function(t){var o,n;t.preventDefault(),U(P.buttonAddCard),(o=N.value,n=B.value,fetch("https://nomoreparties.co/v1/plus-cohort-13/cards",{method:"POST",headers:{authorization:"529f3fca-6bdc-4e81-9927-7f5521acabce","Content-Type":"application/json"},body:JSON.stringify({name:o,link:n})})).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){F.push(t),function(t,e,o,n,r){var c=f(t,e,o,n,!1);C.prepend(c)}(t.name,t.link,t.likes,t._id)})).catch((function(t){return console.log(t)})).finally((function(){Z(P.buttonAddCard),t.target.reset(),e(L)}))})),E.addEventListener("click",(function(){p(Array.from(T),T.buttonAddAvatar,"button-save_inactive"),o(j)})),T.addEventListener("submit",(function(t){var o;t.preventDefault(),U(T.buttonAddAvatar),(o=H.value,fetch("https://mesto.nomoreparties.co/v1/plus-cohort-13/users/me/avatar",{method:"PATCH",headers:{authorization:"529f3fca-6bdc-4e81-9927-7f5521acabce","Content-Type":"application/json"},body:JSON.stringify({avatar:o})})).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).then((function(t){M(t.avatar)})).catch((function(t){return console.log(t)})).finally((function(){Z(T.buttonAddAvatar),t.target.reset(),e(j)}))})),q.addEventListener("click",(function(){z.value=D.textContent,O.value=w.textContent,p(Array.from(x),x.buttonEdit,"button-save_inactive"),o(A)})),g.addEventListener("click",(function(){p(Array.from(P),P.buttonAddCard,"button-save_inactive"),o(L)})),m=(S={formSelector:".edit-from__input-container",inputSelector:".edit-form__edit",buttonSelector:".button-save",editFormErrorClass:"edit-form__edit_error",inactiveButtonClass:"button-save_inactive"}).formSelector,h=S.inputSelector,v=S.buttonSelector,b=S.editFormErrorClass,y=S.inactiveButtonClass,Array.from(document.querySelectorAll(m)).forEach((function(t){var e=t.querySelector(v),o=Array.from(t.querySelectorAll(h));p(o,e,y),o.forEach((function(n){n.addEventListener("input",(function(){!function(t,e,o){e.validity.valid?function(t,e,o){var n=t.querySelector("#".concat(e.id,"-error"));e.classList.remove(o),n.textContent=""}(t,e,o):function(t,e,o,n){var r=t.querySelector("#".concat(e.id,"-error"));e.classList.add(o),r.textContent=n}(t,e,o,e.validationMessage)}(t,n,b),p(o,e,y)}))}))}))})();